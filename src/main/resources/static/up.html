<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Page Title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>

<body>
    <form id="form1" enctype="multipart/form-data">
        <label >头像</label>
        <input type="button" value="上传图片" onclick="f.click()" class="btn_mouseout" /><br>
        <p><input type="file" id="f" name="file" onchange="sc(this);" style="display:none" /></p>
    </form>
    <div id="result"></div>
</body>

<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script>
    function sc() {
        var animateimg = $("#f").val(); //获取上传的图片名 带//
        var imgarr = animateimg.split('\\'); //分割
        var myimg = imgarr[imgarr.length - 1]; //去掉 // 获取图片名
        var houzui = myimg.lastIndexOf('.'); //获取 . 出现的位置
        var ext = myimg.substring(houzui, myimg.length).toUpperCase();  //切割 . 获取文件后缀

        var file = $('#f').get(0).files[0]; //获取上传的文件
        var fileSize = file.size;           //获取上传的文件大小
        var maxSize = 1048576;              //最大1MB
        if (ext != '.PNG' && ext != '.GIF' && ext != '.JPG' && ext != '.JPEG' && ext != '.BMP') {
            parent.layer.msg('文件类型错误,请上传图片类型');
            return false;
        } else if (parseInt(fileSize) >= parseInt(maxSize)) {
            parent.layer.msg('上传的文件不能超过1MB');
            return false;
        } else {
            console.log(111111111)
            var data = new FormData($('#form1')[0]);
            $.ajax({
                url: "http://localhost:8886/upload/img",
                type: 'POST',
                data: data,
                dataType: 'JSON',
                cache: false,
                processData: false,
                contentType: false
            }).done(function (ret) {
                if (ret['isSuccess']) {
                    var result = '';
                    var result1 = '';
                    // $("#show").attr('value',+ ret['f'] +);
                    result += '<img src="' + '__ROAD__' + ret['f'] + '" width="100">';
                    result1 += '<input value="' + ret['f'] + '" name="user_headimg" style="display:none;">';
                    $('#result').html(result);
                    $('#show').html(result1);
                    layer.msg('上传成功');
                } else {
                    layer.msg('上传失败');
                }
            });
            return false;
        }
    }
</script>

</html>